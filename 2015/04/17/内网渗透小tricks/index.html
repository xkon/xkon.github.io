<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>内网渗透小tricks | xkon&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="##0x00 处在内网中我们能干的事
平常我们上网都是处在了内网中，然后经过了nat设备上外网。在内网中我们能干很多有趣的事，嗅探,中间人攻击，种木马等等。">
<meta property="og:type" content="article">
<meta property="og:title" content="内网渗透小tricks">
<meta property="og:url" content="http://xkon.githb.io/2015/04/17/内网渗透小tricks/index.html">
<meta property="og:site_name" content="xkon's Blog">
<meta property="og:description" content="##0x00 处在内网中我们能干的事
平常我们上网都是处在了内网中，然后经过了nat设备上外网。在内网中我们能干很多有趣的事，嗅探,中间人攻击，种木马等等。">
<meta property="og:image" content="http://7xi3ed.com1.z0.glb.clouddn.com/mitmf_arp.PNG">
<meta property="og:image" content="http://7xi3ed.com1.z0.glb.clouddn.com/ettercap_arp.png">
<meta property="og:image" content="http://7xi3ed.com1.z0.glb.clouddn.com/driftnet.png">
<meta property="og:image" content="http://7xi3ed.com1.z0.glb.clouddn.com/hijack_weibo.PNG">
<meta property="og:updated_time" content="2015-10-14T03:53:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="内网渗透小tricks">
<meta name="twitter:description" content="##0x00 处在内网中我们能干的事
平常我们上网都是处在了内网中，然后经过了nat设备上外网。在内网中我们能干很多有趣的事，嗅探,中间人攻击，种木马等等。">
  
    <link rel="alternative" href="/atom.xml" title="xkon&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xkon&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://xkon.githb.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-内网渗透小tricks" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/04/17/内网渗透小tricks/" class="article-date">
  <time datetime="2015-04-17T09:34:53.000Z" itemprop="datePublished">2015-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      内网渗透小tricks
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##0x00 处在内网中我们能干的事</p>
<p>平常我们上网都是处在了内网中，然后经过了nat设备上外网。在内网中我们能干很多有趣的事，嗅探,中间人攻击，种木马等等。</p>
<a id="more"></a>
<h2 id="0x01_使自己成为中间人">0x01 使自己成为中间人</h2><h3 id="mitmf_的ARP攻击">mitmf 的ARP攻击</h3><p><a href="https://github.com/byt3bl33d3r/MITMf/" target="_blank" rel="external">mitmf</a>是一个中间人攻击框架，集成了很多的模块,如下面的ARP欺骗模块，命令使用也很简单。</p>
<p>在kali下安装方法：<br><code>apt-get install mitmf</code></p>
<p>使用mitmf进行ARP欺骗<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmf -i eth0 --spoof --arp --target <span class="number">192.168</span>.<span class="number">254.130</span> --gateway <span class="number">192.168</span>.<span class="number">254.2</span></span><br></pre></td></tr></table></figure></p>
<p><img src="http://7xi3ed.com1.z0.glb.clouddn.com/mitmf_arp.PNG" alt=""></p>
<h3 id="ettercap_的ARP攻击">ettercap 的ARP攻击</h3><p><a href="http://ettercap.github.io/ettercap/" target="_blank" rel="external">Ettercap</a>是一套完整的中间人攻击套件，可以用来执行嗅探、主机分析等。</p>
<blockquote>
<p>Ettercap is a comprehensive suite for man in the middle attacks. It features sniffing of live connections, content filtering on the fly and many other interesting tricks. It supports active and passive dissection of many protocols and includes many features for network and host analysis.</p>
</blockquote>
<p>在这里，我们使用它进行ARP欺骗。ettercap有些不错的插件，可以增强中间人攻击。Ettercap中最重要的插件如下:</p>
<p>dns_spoof (执行DNS欺骗攻击)<br>Dos_attack(对受害主机进行拒绝服务攻击)<br>Chk_poison(检测是否成功进行了攻击)<br>Repoison_arp(顾名思义，修复ARP)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ettercap -T -q -M ARP /<span class="number">192.168</span>.<span class="number">254.130</span>/ //</span><br></pre></td></tr></table></figure>
<p><code>-T</code> 使用文字形式的GUI用户界面<br><code>-q</code> 安静模式(不回显)<br><code>-M &lt;METHOD:ARGS&gt;</code> 实施mitm攻击<br><code>-t &lt;proto&gt;</code> 只对这种协议监听</p>
<p><img src="http://7xi3ed.com1.z0.glb.clouddn.com/ettercap_arp.png" alt=""><br>进入交互模式</p>
<h2 id="0x02_查看流量中的信息">0x02 查看流量中的信息</h2><p>成为中间人之后，受害者的流量就经过了你的机子，你就可以查看流量中的信息了。<br>这里用到<a href="http://www.monkey.org/~dugsong/dsniff/" target="_blank" rel="external">dsniff套件</a>，套件中包括：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">dsniff</span></span><br><span class="line">filesnarf</span><br><span class="line">mailsnarf</span><br><span class="line">msgsnarf</span><br><span class="line">urlsnarf</span><br><span class="line">webspy</span><br><span class="line">arpspoof</span><br><span class="line">dnsspoof</span><br><span class="line">macof</span><br><span class="line">sshmitm</span><br><span class="line">webmitm</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>dsniff is a collection of tools for network auditing and penetration testing. dsniff, filesnarf, mailsnarf, msgsnarf, urlsnarf, and webspy passively monitor a network for interesting data (passwords, e-mail, files, etc.). arpspoof, dnsspoof, and macof facilitate the interception of network traffic normally unavailable to an attacker (e.g, due to layer-2 switching). sshmitm and webmitm implement active monkey-in-the-middle attacks against redirected SSH and HTTPS sessions by exploiting weak bindings in ad-hoc PKI.</p>
</blockquote>
<p>###提取图片</p>
<p><code>工具</code> ：driftnet</p>
<ul>
<li>从eth0中走过的流量中提取所有图片到某一个目录下</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driftnet -i eth0 <span class="operator">-a</span> <span class="operator">-d</span> /tmp/dfritnet/</span><br></pre></td></tr></table></figure>
<p><img src="http://7xi3ed.com1.z0.glb.clouddn.com/driftnet.png" alt=""></p>
<ul>
<li>从文件中提取图片</li>
</ul>
<p>当你用嗅探的方法，拿到了<code>.pcap</code>文件，也可以用<code>driftnet</code>轻易地提取出图片<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driftnet <span class="operator">-f</span> file.pcap <span class="operator">-a</span> <span class="operator">-d</span> /tmp/pics/</span><br></pre></td></tr></table></figure></p>
<h3 id="提取mpeg格式的音频">提取mpeg格式的音频</h3><p>从eth0网卡中嗅探mpeg的音频并保存到/tmp/mpeg/<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driftnet -i eth0 <span class="operator">-s</span> <span class="operator">-d</span> /tmp/mpeg/</span><br></pre></td></tr></table></figure></p>
<h3 id="提取IRC聊天信息">提取IRC聊天信息</h3><p>工具：msgsnarf</p>
<p>国内普通用户用IRC聊天的好像不多，所以这里一笔带过，但是用法更前面的是一样的。</p>
<h3 id="提取密码">提取密码</h3><p>用dsniff来捕获已知协议获取密码</p>
<blockquote>
<p>dsniff is a password sniffer which handles  FTP,  Telnet,  SMTP,  HTTP,<br>POP,  poppass, NNTP, IMAP, SNMP, LDAP, Rlogin, RIP, OSPF, PPTP MS-CHAP,<br>NFS, VRRP, YP/NIS, SOCKS, X11, CVS, IRC, AIM, ICQ, Napster, PostgreSQL,<br>Meeting  Maker, Citrix ICA, Symantec pcAnywhere, NAI Sniffer, Microsoft<br>SMB, Oracle SQL*Net, Sybase and Microsoft SQL protocols.</p>
</blockquote>
<ul>
<li><p>从eth0网卡中嗅探密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dsniff -i eth0</span><br></pre></td></tr></table></figure>
</li>
<li><p>从.pcap文件中获取密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dsniff -p file.pcap</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>##0x03 会话劫持</p>
<p>会话劫持简单一点说就是别人利用了你的会话，然后可以做一些自由你的权限才能做的事。像下面将要讲到的劫持weibo，就是利用受害者登陆了weibo，然后攻击者劫持你的weibo会话，实现在攻击者的机器上也能登陆你的weibo，而不需要你的密码。</p>
<h3 id="ferret和hamster实现"><code>ferret</code>和<code>hamster</code>实现</h3><p>一般能搜索到的会话劫持的工具是利用了<code>ferret</code>和<code>hamster</code>来实现，其中</p>
<ul>
<li>ferret用来在80端口监听提取会话cookies</li>
<li>hamster是一个代理用来操作ferret抓到的数据</li>
</ul>
<p>这里不用这种方法，有兴趣可以自行搜索。</p>
<h3 id="mitmf的会话劫持">mitmf的会话劫持</h3><p>工具：mitmf和mallory</p>
<p>mallory是一个利用session的chrome插件<a href="https://chrome.google.com/extensions/detail/bgidijmlkgjncoaphfdaolejofbblhgl" target="_blank" rel="external">安装点我</a></p>
<p>使用方法：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmf -i eth0 --spoof --arp --target <span class="number">192.168</span>.<span class="number">254.130</span> --gateway <span class="number">192.168</span>.<span class="number">254.2</span> --hijack --mallory</span><br></pre></td></tr></table></figure></p>
<p>成功实现weibo会话劫持：<br><img src="http://7xi3ed.com1.z0.glb.clouddn.com/hijack_weibo.PNG" alt="hijack_weibo"></p>
<h2 id="0x04_HTTP文件下载替换">0x04 HTTP文件下载替换</h2><p>上面讲的都是数据流层面的，嗅探与劫持等，除了这些我们还能渗透主机，像替换下载文件，种入后门。或用重型武器<code>Metasploit</code>直接对安全性弱的主机进行攻击。</p>
<h2 id="0x05_一些中间人攻击的工具">0x05 一些中间人攻击的工具</h2><ol>
<li><a href="https://github.com/byt3bl33d3r/MITMf" target="_blank" rel="external"><code>mitmf</code></a>,一个现成的中间人攻击框架，集成了很多的模块包括sslstrip</li>
<li><a href="https://mitmproxy.org/" target="_blank" rel="external"><code>mitmproxy</code></a>和<code>libmproxy</code> ,证书的替换（ssl中）,操作比sslsplit要方便</li>
<li><a href="https://github.com/droe/sslsplit" target="_blank" rel="external"><code>sslsplit</code></a>,证书的替换</li>
<li><a href="https://github.com/moxie0/sslstrip" target="_blank" rel="external"><code>sslstrip</code></a>,将https替换为http</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xkon.githb.io/2015/04/17/内网渗透小tricks/" data-id="cifqa365u000k1lmdu0ivlwi1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mitm/">mitm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sniff/">sniff</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/内网/">内网</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/05/19/tmux/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          tmux
        
      </div>
    </a>
  
  
    <a href="/2015/04/15/攻击无线WiFi/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">攻击无线WiFi</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JMXInvokerServlet/">JMXInvokerServlet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reverse-Shell/">Reverse Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jboss/">jboss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitm/">mitm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sniff/">sniff</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/">tmux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wifi/">wifi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内网/">内网</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/常见漏洞/">常见漏洞</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/扫描/">扫描</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/端口与服务/">端口与服务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/验证码/">验证码</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JMXInvokerServlet/" style="font-size: 10px;">JMXInvokerServlet</a> <a href="/tags/Kali/" style="font-size: 10px;">Kali</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Reverse-Shell/" style="font-size: 10px;">Reverse Shell</a> <a href="/tags/jboss/" style="font-size: 10px;">jboss</a> <a href="/tags/mitm/" style="font-size: 10px;">mitm</a> <a href="/tags/php/" style="font-size: 20px;">php</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/sniff/" style="font-size: 10px;">sniff</a> <a href="/tags/tmux/" style="font-size: 10px;">tmux</a> <a href="/tags/wifi/" style="font-size: 10px;">wifi</a> <a href="/tags/内网/" style="font-size: 10px;">内网</a> <a href="/tags/常见漏洞/" style="font-size: 10px;">常见漏洞</a> <a href="/tags/扫描/" style="font-size: 10px;">扫描</a> <a href="/tags/端口与服务/" style="font-size: 10px;">端口与服务</a> <a href="/tags/验证码/" style="font-size: 10px;">验证码</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/09/15/常见端口服务及常见漏洞/">常见端口服务及对应漏洞</a>
          </li>
        
          <li>
            <a href="/2015/09/10/Jboss-JMXInvokerServlet探测脚本/">多线程批量Jboss_JMXInvokerServlet探测脚本</a>
          </li>
        
          <li>
            <a href="/2015/09/04/Linux建立反向shell的几种方式/">Linux建立反向shell的几种方式</a>
          </li>
        
          <li>
            <a href="/2015/07/04/PHP多版本切换/">PHP多版本切换</a>
          </li>
        
          <li>
            <a href="/2015/07/02/php配置/">PHP的一些配置可能导致的安全隐患</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 xkon<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>